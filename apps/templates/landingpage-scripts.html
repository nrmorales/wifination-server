{% extends "base.html" %}

{% block scripts %}
<script>
   window.fbAsyncInit = function() {
      FB.init({
         appId      : '248863558597971', // App ID
         channelUrl : 'static/channel.html', // Channel File
         status     : true, // check login status
         cookie     : true, // enable cookies to allow the server to access the session
         xfbml      : true  // parse XFBML
      });

      FB.Event.subscribe('auth.authResponseChange', function(response) {
         console.log("responsechange");
         console.log("response: "+response);
         if (response.status === 'connected') {
            testAPI();
            doLogin();
         } else if (response.status === 'not_authorized') {
            FB.login();
         } else {
            FB.login();
         }
      });

      FB.getLoginStatus(function(response){
         console.log("getLoginStatus")
         if (response.status === 'connected') {
            doLogin();
         }
      });

      //function that gets user info and logs it in the 
      function doLogin(){
         FB.api("/me", function(response){
            console.log("setting form info");
            $("[name='username']").val("wifinationuser")
            $("[name='password']").val("randomstring")
            //$("[name='username']").val(response.username)
            //$("[name='password']").val(response.id)
            //$("[name='first_name']").val(response.first_name)
            //$("[name='last_name']").val(response.last_name)
            //if (response.email) $("[name='email']").val(response.email)
            console.log("submitting form");
            showForm();
            $("#login_form").submit();
         });
      }

      function showForm(){
         var x = $("#login_form");
         console.log(x.serializeArray());
      }
      //add click functionality to login button
      $("button#btn-login").bind("click",function(){FB.login()});
   };

   function testAPI() {
      console.log('Welcome!  Fetching your information.... ');
      FB.api('/me', function(response) {
         console.log('Good to see you, ' + response.name + '.');
      });
   }
</script>
{% endblock %}